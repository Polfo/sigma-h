#summary Guide to building Sigmah on Windows
#sidebar ContributorGuideSideBar

= Introduction =

This guide assumes that you're using Windows. 

== Tools to download and Install ==

Some of the functionality below is available through Eclipse or IntelliJ, but at some point you'll probably want to make a quick call to the command line.

  # [http://download.java.net/jdk6/ JDK, v1.6]
  # [http://tortoisesvn.net/downloads Tortoise SVN] - Windows explorer client for Subversion Version Control System
  # [http://www.open.collab.net/downloads/subversion/ CollabNet Subversion Command-Line Client] - Command-line client for Windows
  # [http://maven.apache.org/download.html Apache Maven] - a build manager for Java. You just need to unzip it in the c:\Program Files folder.
  # Add the paths to the JDK, CollabNet subversion, and Maven paths to the path environment variable. (instructions for [http://www.computerhope.com/issues/ch000549.htm XP] [http://www.question-defense.com/2009/06/22/modify-a-users-path-in-windows-vista-vista-path-environment-variable/ Vista]
  # [http://www.mysql.com/downloads/mysql/ MySQL v5]

*Note:* Microsoft SQL server is no longer a supported database. We are now actively testing against MySQL 5.x and PostgreSQL.

== Quick build in command line ==

We'll get to the IDE in a moment, but first it would be good to confirm that you can successfully build Sigmah/ActivityInfo

  # Checkout a working copy 
{{{
svn checkout http://sigma-h.googlecode.com/svn/trunk sigmah
}}}
  # Change directory to the working copy
{{{
cd sigmah
}}}
  # Invoke the Maven compile and test phases
{{{
mvn test
}}}

Maven will automatically download all required dependencies, compile the project, and run unit and integration tests against an embedded database. 

== Setting up a development database ==

Out of the box, Sigmah will run against H2, an embedded database. As a developer, you will probably want to develop against a running database like MySQL that you can easily inspect and manipulate. 

You can tell sigmah to connect to your local database by creating a sigmah.properties file and saving it to your home directory. (C:\Users\XXXX on Windows Vista and later)

{{{
#
# All Sigmah code is released under the GNU General Public License v3
# See COPYRIGHT.txt and LICENSE.txt.
#

hibernate.dialect=org.hibernate.dialect.MySQLDialect
hibernate.connection.driver_class=com.mysql.jdbc.Driver
hibernate.connection.username=sa
hibernate.connection.password=adminpwd
hibernate.connection.url=jdbc:mysql://localhost/sigmah
hibernate.hbm2ddl.auto=update
hibernate.show_sql=true
hibernate.format_sql=true
}}}

In order to populate your database with default data, you can run step by step all the SQL scripts contained in this zip file: [http://code.google.com/p/sigma-h/downloads/list Sigmah-Mysql-0.8.1]

== Starting GWT development mode in command line ==

For the time being, we are maintaining two separate GWT entry points: ActivityInfoEntryPoint, which will continue to meet the day-to-day needs of existing users, and SigmahEntryPoint, which adds a great deal of new functionality but is not yet ready for production use. 

You can launch GWT development mode for ActivityInfo by running
{{{
mvn gwt:run
}}}

and 
{{{
mvn -P Sigmah gwt:run
}}}

for the Sigmah module.

In order to run maven goal in offline mode, add -o option :
{{{
mvn -o gwt:run
}}}

== Build Sigmah under Eclipse ==

With IDE Eclipse, Java developer can benefit of many usefull plugins to edit the codes, build up the project and debug the project.This guide is based on the Eclipse IDE 3.6 Helios. 

=== Tools and Plugins to Install ===

  # [http://www.eclipse.org/downloads/ Eclipse] - The Eclipse IDE for Java EE developers
  # [http://subclipse.tigris.org/ Subclipse] - An Eclipse Team Provider plug-in providing support for Subversion within the Eclipse IDE.
  # [http://maven.apache.org/eclipse-plugin.html Maven plugin] - Plugins to allow developers to use Maven directly in Eclipse IDE
 
You can use Eclipse Marketplace to search these plugins and then install them.For Eclipse 3.6 Helios, Help->Eclipse Marketplace.

=== Check Out Project from SVN ===

  # Checkout a working copy in Eclipse
{{{
File->New->Other->SVN->Check Out Projects from SVN
}}} 
Then you enter the SVN server address
{{{
http://sigma-h.googlecode.com/svn/trunk
}}} 
Choose the folder Sigmah to check out.

Make sure you choose _check out as a  project configured using the New Project Wizard_ and then choose the _Java->Java Project_ .

# Enable Maven Dependency Management

After you check out the project to your IDE workspace, you may have many errors. It is normal because you should enable the Maven Dependency Management 
{{{
Right-click project->Maven->Enable Dependency Management
}}} 

Then you refresh your project.

=== Set Up Local Database ===

As a developer, before you test the sigmah project, you have to set up your own database system.
Sigmah is now based on the database system MySql 5. But it also works with Postgresql.

# Create the Database

In order to create a correct database for Sigmah and populate your database with default data, you can run step by step all the SQL scripts contained in this zip file:[http://code.google.com/p/sigma-h/downloads/list Sigmah-Mysql-0.8.1]

You can use some graphical management tools to accomplish that task, such as _phpMyAdmin_.

*Note:* You should first run the scrips in zip file _MinimumDataKit-0.8.1.zip_ and then _DemoData-0.8.1.zip_

# Configure Project to Use Local Database

Now you should tell Sigmah project to use your own database. All you need to do is just to modify some values of a properties file: _Sigmah.properties_,which is in _war/WEB-INF_. It looks like this:
{{{
#
# All Sigmah code is released under the GNU General Public License v3
# See COPYRIGHT.txt and LICENSE.txt.
#

hibernate.dialect=org.hibernate.dialect.MySQLDialect
hibernate.connection.driver_class=com.mysql.jdbc.Driver
hibernate.connection.username=root
hibernate.connection.password=adminpwd
hibernate.connection.url=jdbc:mysql://localhost:3306/sigmah
hibernate.hbm2ddl.auto=update
hibernate.show_sql=true
hibernate.format_sql=true

}}}

You should make sure the user that you specify for _username_ has enough rights to access and modify the database _sigmah_.

=== Build and Debug Sigmah ===

Now it is ready to build and debug our Sigmah project.

# Set Up Debug Configuration
{{{
Run->Debug Configuration->Maven Build
}}}
and then
{{{
Right-click _Maven Build_ ->New
}}}

Rename the configuration as you want.Then you will have some properties to configure:
{{{
Base directory: your project directory
Goals: gwt:run
Profiles: sigmah
Debug output: Check
Offline: Check
}}}

This kind of Debug configuration will launch the GWT development mode for Sigmah project. Maven will be responsible for downloading all dependencies including GWT Libraries,GXT Libraries to a local repository(Normally, it is ~/.m2/repository). 

The _offline_ feature makes Maven use the local repository to build your project after the first build to save the time of building. If you want Maven to download all libraries every time, you uncheck that feature.

# Resolve the "OutOfMemory" Problem

For this moment, when you luanch sigmah in GWT Development Mode,you may have a "OutOfMemory:PermSpace". To solve this error, you should specify a bigger PermSpace in the Pom.xml file, which is in your project root directory.
{{{

            <!--  configure the GWT-Maven plugin -->
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>gwt-maven-plugin</artifactId>
                <version>1.2</version>
                <configuration>
                    <runTarget>/</runTarget>
                    <logLevel>TRACE</logLevel>
                    <inplace>false</inplace>
                    <gwtVersion>${gwtVersion}</gwtVersion>
                    <port>9090</port>
                    <module>org.sigmah.ActivityInfoProduction</module>
                    <webappDirectory>${basedir}/war</webappDirectory>
                    <warSourceDirectory>${basedir}/war</warSourceDirectory>
                    <extraJvmArgs>-Xmx512M -Xss1M -XX:MaxPermSize=512M
                    </extraJvmArgs>                                                                
                </configuration>

}}}

For the _extraJvmArgs_ property, you can add a new option *-XX:MaxPermSize* to give a bigger Perm Space.
